---
// src/components/SiteHeader.astro

interface Props {
  logoSrc?: string;
  brand?: string;
  ctaHref?: string;
  ctaText?: string;
}
const {
  logoSrc = "/images/brand/age.avif",
  brand = "Amrita Fashions",
  ctaHref = "#contact",
  ctaText = "Get Quote Now",
} = Astro.props as Props;
---

<a class="skip-link" href="#main">Skip to content</a>

<header class="site-header" role="banner">
  <!-- keep the checkbox at header root -->
  <input id="nav-open" class="nav-toggle" type="checkbox" aria-hidden="true" />

  <div class="container">
    <div class="nav-shell">
      <!-- Brand -->
      <a href="/" class="brand" aria-label={brand}>
        {logoSrc ? (
          <img
            src={logoSrc}
            alt={brand}
            class="logo"
            width="160"
            height="48"
            fetchpriority="high"
          />
        ) : (
          <span class="brand-text">{brand}</span>
        )}
      </a>

      <!-- Center links -->
      <nav class="nav-links" aria-label="Primary">
        <a href="/" class="link is-active" aria-current="page">Home</a>
        <a href="#aboutus" class="link">About</a>
        <a href="#products" class="link">Products</a>
        <a href="#testimonials" class="link">Testimonials</a>
        <a href="#faq" class="link">FAQ</a>
        <a href="#contact" class="link">Contact</a>
      </nav>

      <!-- Country + State + City Selector -->
      <div class="country-selector">
        <button
          class="country-trigger"
          aria-expanded="false"
          aria-haspopup="true"
          aria-label="Select country, state and city"
        >
          <span class="flag-placeholder"></span>
          <span class="country-code">IN</span>
          <i class="chev" aria-hidden="true"></i>
        </button>

        <!-- Mega dropdown -->
        <div
          class="country-dropdown"
          role="dialog"
          aria-label="Country, state and city selection"
        >
          <div class="country-mega">
            <div class="country-mega-header">
              <span class="country-mega-title">CHOOSE YOUR LOCATION</span>
            </div>

            <div class="country-mega-body">
              <!-- Left: all countries -->
              <div class="country-column">
                <div class="country-search-container">
                  <input
                    type="text"
                    class="country-search"
                    placeholder="Search country..."
                    aria-label="Search countries"
                  />
                </div>
                <div class="country-list">
                  <!-- Countries will be populated by JavaScript -->
                </div>
              </div>

              <!-- Middle: states of selected country -->
              <div class="state-column">
                <div class="state-column-header">
                  <span class="state-column-title">
                    States in <span class="selected-country-name">‚Äî</span>
                  </span>
                </div>
                <div class="state-list">
                  <!-- States will be populated by JavaScript -->
                </div>
              </div>

              <!-- Right: cities of selected state -->
              <div class="city-column">
                <div class="city-column-header">
                  <span class="city-column-title">
                    Cities in <span class="selected-state-name">‚Äî</span>
                  </span>
                </div>
                <div class="city-list">
                  <!-- Cities will be populated by JavaScript -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CTA -->
      <a class="btn cta" href={ctaHref}>
        <span>{ctaText}</span>
        <i class="chev" aria-hidden="true"></i>
      </a>

      <!-- Enhanced hamburger menu -->
      <label
        for="nav-open"
        class="hamburger"
        role="button"
        tabindex="0"
        aria-haspopup="menu"
        aria-controls="mobile-menu"
        aria-label="Toggle menu"
      >
        <span class="hamburger-box">
          <span class="hamburger-inner"></span>
        </span>
      </label>
    </div>
  </div>

  <!-- Mobile overlay + drawer -->
  <label for="nav-open" class="overlay" aria-hidden="true"></label>
  <div
    class="mobile-drawer"
    id="mobile-menu"
    role="dialog"
    aria-modal="true"
    aria-label="Mobile navigation"
  >
    <nav class="mobile-nav" aria-label="Mobile">
      <div class="mobile-nav-header">
        <span class="mobile-nav-title">Menu</span>
        <label
          for="nav-open"
          class="close-menu"
          role="button"
          aria-label="Close menu"
          aria-controls="mobile-menu"
          tabindex="0"
        >
          <span class="close-menu-icon" aria-hidden="true"></span>
        </label>
      </div>
      <a href="/" class="m-link is-active" aria-current="page">Home</a>
      <a href="#products" class="m-link">Products</a>
      <a href="#testimonials" class="m-link">Testimonials</a>
      <a href="#faq" class="m-link">FAQ</a>
      <a href="#contact" class="m-link">Contact</a>

      <a href={ctaHref} class="btn m-cta">
        <span>{ctaText}</span><i class="chev" aria-hidden="true"></i>
      </a>
    </nav>
  </div>
</header>

<script is:inline>
  (function () {
    const cb = document.getElementById("nav-open");
    const header = document.querySelector(".site-header");
    const label = document.querySelector(".hamburger");
    const closeLabel = document.querySelector(".close-menu");
    const navLinks = Array.from(
      document.querySelectorAll(".nav-links .link, .mobile-nav .m-link")
    );

    const sectionIds = ["aboutus", "products", "testimonials", "faq", "contact"];

    // Country / state / city selector elements
    const countryTrigger = document.querySelector(".country-trigger");
    const countryDropdown = document.querySelector(".country-dropdown");
    const countryList = document.querySelector(".country-list");
    const countrySearch = document.querySelector(".country-search");
    const flagPlaceholder = document.querySelector(".flag-placeholder");
    const countryCode = document.querySelector(".country-code");
    const selectedCountryNameEl = document.querySelector(
      ".selected-country-name"
    );
    const stateListEl = document.querySelector(".state-list");
    const cityListEl = document.querySelector(".city-list");
    const selectedStateNameEl = document.querySelector(".selected-state-name");

    // Data
    let countries = [];
    let statesByCountry = {}; // { "IN": [ {name, slug, code, countryCode}, ... ] }
    let citiesByStateKey = {}; // { "IN-GJ": [ {name, slug}, ... ] }

    // default India active
    let userCountry = "IN";

    // URL-derived slugs for highlighting
    let urlProductSlug = null;
    let urlCountrySlug = null;
    let urlStateSlug = null;
    let urlCitySlug = null;

    // current selection for city column
    let currentStateKey = null; // "IN-GJ"
    let currentStateName = "";
    let currentCountrySlug = null;
    let currentStateSlug = null;

    // track if geo selection changed; reload page on close only if true
    let hasGeoChanged = false;

    /* ================= Helpers for slugs & URLs ================= */

    function slugifyClient(value) {
      return String(value || "")
        .trim()
        .toLowerCase()
        .replace(/['‚Äô]/g, "")
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "");
    }

    // parse current path: /:productSlug/in/:countrySlug/:stateSlug?/:citySlug?
    function parseGeoFromPath() {
      const path = window.location.pathname.replace(/\/+$/, "");
      const parts = path.split("/").filter(Boolean);
      const inIdx = parts.indexOf("in");
      if (inIdx === -1) {
        return {
          productSlug: parts[0] || null,
          countrySlug: null,
          stateSlug: null,
          citySlug: null,
        };
      }
      const productSlug = parts[0] || null;
      const countrySlug = parts[inIdx + 1] || null;
      const stateSlug = parts[inIdx + 2] || null;
      const citySlug = parts[inIdx + 3] || null;
      return { productSlug, countrySlug, stateSlug, citySlug };
    }

    // initialize URL slugs
    (function initUrlSlugs() {
      const parsed = parseGeoFromPath();
      if (parsed) {
        urlProductSlug = parsed.productSlug;
        urlCountrySlug = parsed.countrySlug
          ? parsed.countrySlug.toLowerCase()
          : null;
        urlStateSlug = parsed.stateSlug ? parsed.stateSlug.toLowerCase() : null;
        urlCitySlug = parsed.citySlug ? parsed.citySlug.toLowerCase() : null;
        currentCountrySlug = urlCountrySlug;
        currentStateSlug = urlStateSlug;
      }
    })();

    // which product slug to use when we navigate
    function getProductSlug() {
      const meta = document.querySelector('meta[name="x-product-slug"]');
      if (meta && meta.content) {
        const v = meta.content.trim();
        if (v) return v;
      }
      if (urlProductSlug) return urlProductSlug;
      const parts = window.location.pathname.split("/").filter(Boolean);
      return parts[0] || "";
    }

    // Build a flag image URL
    function getFlagUrl(code) {
      const c = (code || "").toLowerCase();
      if (!c || c.length !== 2) return "";
      return `https://flagcdn.com/w20/${c}.png`;
    }

    // change URL but DON'T reload page immediately
    function navigateToGeoPage(countrySlug, stateSlug, citySlug) {
      const productSlug = getProductSlug();
      if (!productSlug || !countrySlug) return;

      let path = `/${productSlug}/in/${countrySlug.toLowerCase()}`;
      if (stateSlug) path += `/${stateSlug.toLowerCase()}`;
      if (citySlug) path += `/${citySlug.toLowerCase()}`;

      history.replaceState(null, "", path);

      urlProductSlug = productSlug.toLowerCase();
      urlCountrySlug = countrySlug.toLowerCase();
      urlStateSlug = stateSlug ? stateSlug.toLowerCase() : null;
      urlCitySlug = citySlug ? citySlug.toLowerCase() : null;
      currentCountrySlug = urlCountrySlug;
      currentStateSlug = urlStateSlug;

      hasGeoChanged = true;
    }

    /* ================= Fetching ================= */

    async function fetchCountries() {
      try {
        const response = await fetch(
          "https://test.amrita-fashions.com/api/countries"
        );
        if (!response.ok) throw new Error("Failed to fetch countries");
        const json = await response.json();
        countries = Array.isArray(json)
          ? json
          : json?.data?.countries || json?.data || [];
        populateCountryList();
        hydrateCountryFromUrlOrDetect();
      } catch (err) {
        console.error("Error fetching countries:", err);
        countries = [
          { code: "IN", name: "India", slug: "india" },
          { code: "US", name: "United States" },
          { code: "GB", name: "United Kingdom" },
          { code: "CA", name: "Canada" },
          { code: "AU", name: "Australia" },
        ];
        populateCountryList();
        hydrateCountryFromUrlOrDetect();
      }
    }

    async function fetchStates() {
      try {
        const response = await fetch(
          "https://test.amrita-fashions.com/api/states"
        );
        if (!response.ok) throw new Error("Failed to fetch states");
        const json = await response.json();

        let raw = [];
        if (Array.isArray(json)) raw = json;
        else if (Array.isArray(json?.data?.states)) raw = json.data.states;
        else if (Array.isArray(json?.data)) raw = json.data;
        else if (Array.isArray(json.states)) raw = json.states;

        statesByCountry = {};

        raw.forEach((st) => {
          const name =
            st.name || st.stateName || st.state || st.title || st.label;
          if (!name) return;

          let countryCode =
            (st.country &&
              (st.country.code ||
                st.country.code2 ||
                st.country.iso2 ||
                st.country.isoCode ||
                st.country.slug)) ||
            st.countryCode ||
            st.country_code ||
            st.country ||
            "";

          if (typeof countryCode === "object" && countryCode) {
            countryCode =
              countryCode.code ||
              countryCode.code2 ||
              countryCode.iso2 ||
              countryCode.isoCode ||
              countryCode.slug ||
              "";
          }

          countryCode = (countryCode || "").toUpperCase();
          if (!countryCode || countryCode.length !== 2) return;

          let stateCode = st.code || st.stateCode || st.abbreviation || "";
          stateCode = (stateCode || "").toUpperCase();

          const slug =
            st.slug ||
            st.stateSlug ||
            String(name)
              .toLowerCase()
              .replace(/[^a-z0-9]+/g, "-")
              .replace(/(^-|-$)/g, "");

          if (!statesByCountry[countryCode]) statesByCountry[countryCode] = [];
          statesByCountry[countryCode].push({
            name,
            slug,
            code: stateCode,
            countryCode,
          });
        });

        renderStateList();
      } catch (err) {
        console.error("Error fetching states:", err);
      }
    }

    async function fetchCities() {
      try {
        const response = await fetch(
          "https://test.amrita-fashions.com/api/cities"
        );
        if (!response.ok) throw new Error("Failed to fetch cities");
        const json = await response.json();

        let raw = [];
        if (Array.isArray(json)) raw = json;
        else if (Array.isArray(json?.data?.cities)) raw = json.data.cities;
        else if (Array.isArray(json?.data)) raw = json.data;
        else if (Array.isArray(json.cities)) raw = json.cities;

        citiesByStateKey = {};

        raw.forEach((ct) => {
          const name =
            ct.name || ct.cityName || ct.city || ct.title || ct.label;
          if (!name) return;

          let countryCode =
            (ct.country &&
              (ct.country.code ||
                ct.country.code2 ||
                ct.country.iso2 ||
                ct.country.isoCode ||
                ct.country.slug)) ||
            ct.countryCode ||
            ct.country_code ||
            "";

          if (typeof countryCode === "object" && countryCode) {
            countryCode =
              countryCode.code ||
              countryCode.code2 ||
              countryCode.iso2 ||
              countryCode.isoCode ||
              countryCode.slug ||
              "";
          }

          let stateCode =
            (ct.state &&
              (ct.state.code ||
                ct.state.code2 ||
                ct.state.iso2 ||
                ct.state.isoCode ||
                ct.state.slug)) ||
            ct.stateCode ||
            ct.state_code ||
            "";

          if (typeof stateCode === "object" && stateCode) {
            stateCode =
              stateCode.code ||
              stateCode.code2 ||
              stateCode.iso2 ||
              stateCode.isoCode ||
              stateCode.slug ||
              "";
          }

          countryCode = (countryCode || "").toUpperCase();
          stateCode = (stateCode || "").toUpperCase();
          if (!countryCode || !stateCode) return;

          const key = `${countryCode}-${stateCode}`;
          const slug =
            ct.slug ||
            slugifyClient(name || "") ||
            `${countryCode.toLowerCase()}-${stateCode.toLowerCase()}`;

          if (!citiesByStateKey[key]) citiesByStateKey[key] = [];
          citiesByStateKey[key].push({ name, slug });
        });

        renderCityList();
      } catch (err) {
        console.error("Error fetching cities:", err);
      }
    }

    /* ================= Rendering ================= */

    function populateCountryList() {
      if (!countryList) return;
      countryList.innerHTML = "";

      const sorted = [...countries].sort((a, b) =>
        String(a.name || "").localeCompare(String(b.name || ""))
      );

      sorted.forEach((country) => {
        if (!country.code || !country.name) return;
        const code = String(country.code).toUpperCase();
        const slug = slugifyClient(country.slug || country.name);
        const url = getFlagUrl(code);

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "country-item";
        btn.setAttribute("data-code", code);
        btn.setAttribute("data-slug", slug);
        btn.innerHTML = `
          <span class="country-flag">
            ${
              url
                ? `<img src="${url}" alt="${country.name} flag" class="flag-img" loading="lazy" width="20" height="15" />`
                : "üåê"
            }
          </span>
          <span class="country-name">${country.name}</span>
        `;

        btn.addEventListener("click", () => {
          selectCountry(code, slug);
        });

        countryList.appendChild(btn);
      });

      updateCountryDisplay();
    }

    function renderStateList() {
      if (!stateListEl || !selectedCountryNameEl) return;
      const code = (userCountry || "IN").toUpperCase();

      const countryObj = countries.find(
        (c) => (c.code || "").toUpperCase() === code
      );
      const countryName = countryObj?.name || code;
      const countrySlug = slugifyClient(
        countryObj?.slug || countryObj?.name || code
      );

      selectedCountryNameEl.textContent = countryName;
      stateListEl.innerHTML = "";

      const states = (statesByCountry[code] || [])
        .slice()
        .sort((a, b) => a.name.localeCompare(b.name));

      if (!states.length) {
        const empty = document.createElement("div");
        empty.className = "state-empty";
        empty.textContent = "No states found for this country.";
        stateListEl.appendChild(empty);
        currentStateKey = null;
        currentStateName = "";
        renderCityList();
        return;
      }

      let fromUrlKey = null;
      let fromUrlStateName = "";

      states.forEach((st) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "state-item";
        btn.textContent = st.name;
        btn.setAttribute("data-state-slug", st.slug);
        btn.setAttribute("data-country-slug", countrySlug);
        btn.setAttribute("data-state-code", st.code || "");
        btn.setAttribute("data-country-code", st.countryCode || code);

        if (urlStateSlug && st.slug.toLowerCase() === urlStateSlug) {
          btn.classList.add("selected");
          const cCode = (st.countryCode || code || "").toUpperCase();
          const sCode = (st.code || "").toUpperCase();
          if (cCode && sCode) {
            fromUrlKey = `${cCode}-${sCode}`;
            fromUrlStateName = st.name;
          }
        }

        btn.addEventListener("click", () => {
          const cSlug =
            btn.getAttribute("data-country-slug") || countrySlug || "";
          const sSlug = btn.getAttribute("data-state-slug") || st.slug || "";
          const cCode =
            (btn.getAttribute("data-country-code") || code || "").toUpperCase();
          const sCode =
            (btn.getAttribute("data-state-code") || st.code || "").toUpperCase();

          if (!cSlug || !sSlug) return;

          stateListEl
            .querySelectorAll(".state-item")
            .forEach((el) => el.classList.remove("selected"));
          btn.classList.add("selected");

          currentStateKey = cCode && sCode ? `${cCode}-${sCode}` : null;
          currentStateName = st.name;
          currentCountrySlug = cSlug;
          currentStateSlug = sSlug;

          renderCityList();

          navigateToGeoPage(cSlug, sSlug);
        });

        stateListEl.appendChild(btn);
      });

      if (fromUrlKey) {
        currentStateKey = fromUrlKey;
        currentStateName = fromUrlStateName;
      }

      renderCityList();
    }

    function renderCityList() {
      if (!cityListEl || !selectedStateNameEl) return;

      selectedStateNameEl.textContent =
        currentStateName && currentStateKey ? currentStateName : "‚Äî";

      cityListEl.innerHTML = "";

      if (!currentStateKey) {
        const empty = document.createElement("div");
        empty.className = "city-empty";
        empty.textContent = "Select a state to see cities.";
        cityListEl.appendChild(empty);
        return;
      }

      const cities = (citiesByStateKey[currentStateKey] || [])
        .slice()
        .sort((a, b) => a.name.localeCompare(b.name));

      if (!cities.length) {
        const empty = document.createElement("div");
        empty.className = "city-empty";
        empty.textContent = "No cities found for this state.";
        cityListEl.appendChild(empty);
        return;
      }

      cities.forEach((ct) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "city-item";
        btn.textContent = ct.name;
        btn.setAttribute("data-city-slug", ct.slug || "");

        if (urlCitySlug && ct.slug && ct.slug.toLowerCase() === urlCitySlug) {
          btn.classList.add("selected");
        }

        btn.addEventListener("click", () => {
          const citySlug = btn.getAttribute("data-city-slug") || ct.slug || "";
          if (!citySlug) return;

          cityListEl
            .querySelectorAll(".city-item")
            .forEach((el) => el.classList.remove("selected"));
          btn.classList.add("selected");

          const cSlug = currentCountrySlug || urlCountrySlug || "";
          const sSlug = currentStateSlug || urlStateSlug || "";
          if (!cSlug) return;

          navigateToGeoPage(cSlug, sSlug, citySlug);
        });

        cityListEl.appendChild(btn);
      });
    }

    /* ================= Country selection / display ================= */

    function updateCountryDisplay() {
      const code = (userCountry || "IN").toUpperCase();
      const flagUrl = getFlagUrl(code);

      if (flagPlaceholder) {
        if (flagUrl) {
          flagPlaceholder.innerHTML = `<img src="${flagUrl}" alt="${code} flag" class="flag-img" loading="lazy" width="20" height="15" />`;
        } else {
          flagPlaceholder.textContent = "üåê";
        }
      }

      if (countryCode) {
        countryCode.textContent = code;
      }

      document
        .querySelectorAll(".country-item")
        .forEach((item) => {
          const itemCode = (item.getAttribute("data-code") || "").toUpperCase();
          const isSelected = itemCode === code;
          item.classList.toggle("selected", isSelected);
          if (isSelected) {
            item.setAttribute("data-hidden-selected", "true");
          } else {
            item.removeAttribute("data-hidden-selected");
          }
        });

      // mark trigger as active when we have a selected country
      if (countryTrigger) {
        countryTrigger.classList.add("is-active");
      }

      renderStateList();
    }

    function hydrateCountryFromUrlOrDetect() {
      let appliedFromUrl = false;

      if (urlCountrySlug && countries.length) {
        const match = countries.find((c) => {
          const slug = slugifyClient(c.slug || c.name || "");
          return slug === urlCountrySlug;
        });
        if (match && match.code) {
          userCountry = String(match.code).toUpperCase();
          appliedFromUrl = true;
        }
      }

      if (appliedFromUrl) {
        updateCountryDisplay();
      } else {
        detectUserCountry();
      }
    }

    function selectCountry(code, countrySlug) {
      userCountry = code.toUpperCase();
      currentCountrySlug = countrySlug;
      currentStateKey = null;
      currentStateName = "";
      urlStateSlug = null;
      urlCitySlug = null;

      updateCountryDisplay();
      try {
        localStorage.setItem("selectedCountry", userCountry);
      } catch (e) {}

      if (countrySlug) {
        navigateToGeoPage(countrySlug);
      }
    }

    function detectUserCountry() {
      let fromStorage = null;
      try {
        const stored = localStorage.getItem("selectedCountry");
        if (stored) fromStorage = stored.toUpperCase();
      } catch (e) {}

      if (
        fromStorage &&
        countries.some((c) => c.code?.toUpperCase() === fromStorage)
      ) {
        userCountry = fromStorage;
      } else {
        userCountry = "IN";
      }
      updateCountryDisplay();
    }

    /* ================= Dropdown behaviour ================= */

    function toggleCountryDropdown() {
      const isExpanded = countryTrigger.getAttribute("aria-expanded") === "true";
      const next = !isExpanded;
      countryTrigger.setAttribute("aria-expanded", String(next));
      countryDropdown.classList.toggle("open", next);

      if (next && countrySearch) {
        countrySearch.value = "";
        filterCountries();
        countrySearch.focus();
      }
    }

    function closeCountryDropdown() {
      if (!countryDropdown.classList.contains("open")) return;

      countryTrigger.setAttribute("aria-expanded", "false");
      countryDropdown.classList.remove("open");

      if (hasGeoChanged) {
        window.location.reload();
      }
    }

    function filterCountries() {
      if (!countryList) return;
      const term = (countrySearch?.value || "").toLowerCase();
      countryList.querySelectorAll(".country-item").forEach((item) => {
        const name = item
          .querySelector(".country-name")
          .textContent.toLowerCase();
        const hiddenSelected = item.hasAttribute("data-hidden-selected");
        const match = name.includes(term);
        item.style.display = match && !hiddenSelected ? "flex" : "none";
      });
    }

    if (countryTrigger && countryDropdown) {
      countryTrigger.addEventListener("click", toggleCountryDropdown);

      document.addEventListener("click", (e) => {
        if (
          !countryTrigger.contains(e.target) &&
          !countryDropdown.contains(e.target)
        ) {
          closeCountryDropdown();
        }
      });

      if (countrySearch) {
        countrySearch.addEventListener("input", filterCountries);
      }

      countryTrigger.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          toggleCountryDropdown();
        } else if (e.key === "Escape") {
          closeCountryDropdown();
        }
      });
    }

    /* ================= Existing nav logic ================= */

    function syncAria() {
      if (label && cb) {
        label.setAttribute("aria-expanded", cb.checked ? "true" : "false");
      }
      if (closeLabel && cb) {
        closeLabel.setAttribute("aria-expanded", cb.checked ? "true" : "false");
      }
    }

    function setBodyOffset() {
      const currentVar =
        parseFloat(
          getComputedStyle(document.documentElement).getPropertyValue(
            "--header-h"
          )
        ) || 96;
      let h = header?.offsetHeight || currentVar;
      if (h < 40) h = currentVar;
      document.documentElement.style.setProperty("--header-h", h + "px");
      document.body.style.paddingTop = h + "px";
    }

    function clearActive() {
      navLinks.forEach((link) => {
        link.classList.remove("is-active");
        link.removeAttribute("aria-current");
      });
    }

    function setActiveFor(target) {
      clearActive();

      if (target === "home") {
        document
          .querySelectorAll(
            '.nav-links .link[href="/"], .mobile-nav .m-link[href="/"]'
          )
          .forEach((link) => {
            link.classList.add("is-active");
            link.setAttribute("aria-current", "page");
          });
        return;
      }

      const selector = `.nav-links .link[href="#${target}"], .mobile-nav .m-link[href="#${target}"]`;
      const matches = document.querySelectorAll(selector);
      if (matches.length) {
        matches.forEach((link) => {
          link.classList.add("is-active");
          link.setAttribute("aria-current", "true");
        });
      } else {
        setActiveFor("home");
      }
    }

    function updateActiveLink() {
      const hash = (window.location.hash || "").replace("#", "");
      if (hash && sectionIds.includes(hash)) {
        setActiveFor(hash);
        return;
      }

      const offset = (header?.offsetHeight || 0) + 40;
      const scrollY = (window.scrollY || 0) + offset;

      let active = "home";
      sectionIds.forEach((id) => {
        const el = document.getElementById(id);
        if (!el) return;
        if (scrollY >= el.offsetTop) {
          active = id;
        }
      });

      setActiveFor(active);
    }

    function onScroll() {
      const y = window.scrollY || 0;
      if (y > 12) header?.classList.add("is-scrolled");
      else header?.classList.remove("is-scrolled");
      updateActiveLink();
    }

    function closeMenu() {
      if (!cb) return;
      cb.checked = false;
      syncAria();
      setTimeout(setBodyOffset, 200);
    }

    document.addEventListener("click", (e) => {
      const target = e.target;
      if (!(target instanceof Element)) return;

      if (
        target.closest(".mobile-nav a") ||
        target.closest(".m-cta") ||
        target.closest(".overlay") ||
        (target.closest(".mobile-drawer") &&
          !target.closest(".mobile-nav")) ||
        target.closest(".close-menu")
      ) {
        closeMenu();
      }

      const navAnchor = target.closest(
        ".nav-links .link, .mobile-nav .m-link, .age-footer .age-navLink"
      );

      if (!navAnchor) return;

      const href = navAnchor.getAttribute("href") || "";

      if (href.startsWith("#")) {
        const id = href.slice(1);
        const el = document.getElementById(id);
        if (el) {
          e.preventDefault();
          const offset = (header?.offsetHeight || 0) + 24;
          const top =
            el.getBoundingClientRect().top + window.scrollY - offset;

          window.scrollTo({ top, behavior: "smooth" });
          setActiveFor(id);
          history.replaceState(null, "", "#" + id);
        }
      }

      if (href === "/") {
        const samePath =
          window.location.pathname === "/" ||
          window.location.pathname === navAnchor.pathname;
        if (samePath) {
          e.preventDefault();
          window.scrollTo({ top: 0, behavior: "smooth" });
          setActiveFor("home");
        }
      }
    });

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeMenu();
        closeCountryDropdown();
      }
    });

    window.addEventListener(
      "resize",
      () => {
        if (window.innerWidth > 1100) closeMenu();
        setBodyOffset();
      },
      { passive: true }
    );

    window.addEventListener("scroll", onScroll, { passive: true });

    setBodyOffset();

    cb &&
      cb.addEventListener("change", () => {
        syncAria();
        setBodyOffset();
      });

    if (closeLabel) {
      closeLabel.addEventListener("click", (e) => {
        e.preventDefault();
        closeMenu();
      });
    }

    closeLabel &&
      closeLabel.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") {
          e.preventDefault();
          closeMenu();
        }
      });

    window.addEventListener(
      "load",
      () => {
        if ("scrollRestoration" in history)
          history.scrollRestoration = "manual";

        syncAria();
        setBodyOffset();
        onScroll();
        setActiveFor("home");

        fetchCountries();
        fetchStates();
        fetchCities();
      },
      { once: true }
    );

    if ("ResizeObserver" in window && header) {
      new ResizeObserver(setBodyOffset).observe(header);
    }
  })();
</script>

<style>
:root {
  --header-h: 96px;
}
body {
  padding-top: var(--header-h);
}

/* ---------- a11y ---------- */
.skip-link {
  position: absolute;
  left: -10000px;
  top: auto;
  width: 1px;
  height: 1px;
  overflow: hidden;
  background: var(--tp-common-white);
  color: var(--tp-text-1);
  font-weight: 600;
  padding: 12px 16px;
  border-radius: 8px;
  z-index: 2000;
  box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
  transition: opacity 0.2s ease;
}
.skip-link:focus {
  left: 16px;
  top: 16px;
  width: auto;
  height: auto;
  opacity: 1;
}

/* ---------- header container (fixed) ---------- */
.site-header {
  --nav-bg: var(--tp-nav-bg, rgba(255, 255, 255, 0.86));
  --nav-border: var(--tp-nav-border, rgba(17, 35, 56, 0.1));
  --nav-shadow: var(--tp-nav-shadow, 0 10px 30px rgba(17, 35, 56, 0.1));
  --nav-pad-y: var(--tp-nav-pad-y, 12px);
  --nav-pad-x: var(--tp-nav-pad-x, 16px);

  --brand: var(--tp-theme-primary, #2c4c97);
  --gold: var(--tp-theme-secondary, #d6a74b);
  --ink: var(--tp-text-1, #0f2235);
  --ink-dim: rgba(15, 34, 53, 0.72);

  position: fixed;
  left: 0;
  right: 0;
  top: 0;
  z-index: 900;
  background: transparent;
  padding-block: clamp(6px, 1.2vw, 12px);
  transition: padding 0.25s ease, background 0.25s ease, box-shadow 0.3s ease;
}
.site-header.is-scrolled {
  background: rgba(255, 255, 255, 0.96);
  box-shadow: 0 1px 0 rgba(12, 28, 52, 0.08);
  backdrop-filter: blur(12px);
}

/* ---------- pill shell ---------- */
.nav-shell {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: clamp(16px, 2vw, 32px);
  width: 100%;
  padding: var(--nav-pad-y) var(--nav-pad-x);
  background: var(--nav-bg);
  border: 1px solid var(--nav-border);
  border-radius: 9999px;
  box-shadow: var(--nav-shadow);
  -webkit-backdrop-filter: saturate(140%) blur(10px);
  backdrop-filter: saturate(140%) blur(10px);
  transition: all 0.3s ease;
  min-width: 0;
}
.site-header.is-scrolled .nav-shell {
  background: transparent;
  border: none;
  box-shadow: none;
  border-radius: 0;
}

/* Brand */
.brand {
  display: flex;
  align-items: center;
  gap: 10px;
  min-height: 44px;
  padding-inline: 6px;
  transition: transform 0.2s ease;
  flex: 0 0 auto;
}
.brand:hover {
  transform: translateY(-1px);
}

/* Logo */
.logo {
  display: block;
  width: auto;
  height: 48px;
  max-height: 48px;
  border-radius: 12px;
  transition: all 0.3s ease;
}
.brand-text {
  font: 800 18px/1 var(--tp-ff-display, system-ui);
  letter-spacing: 0.2px;
  color: var(--ink);
  transition: color 0.2s ease;
}

/* Links */
.nav-links {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: clamp(16px, 2.4vw, 36px);
  flex: 1 1 auto;
  min-width: 0;
  margin-inline: clamp(12px, 4vw, 56px);
}
.link {
  position: relative;
  display: inline-flex;
  align-items: center;
  color: var(--ink-dim);
  font-weight: 600;
  letter-spacing: 0.08px;
  padding: 10px 16px;
  border-radius: 10px;
  line-height: 1;
  transition: all 0.25s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  outline: none;
  font-size: 15px;
}
.link::after {
  content: "";
  position: absolute;
  left: 16px;
  right: 16px;
  bottom: 6px;
  height: 2px;
  border-radius: 1px;
  background: transparent;
  transform: scaleX(0);
  transform-origin: center;
  transition: transform 0.25s ease, background 0.25s ease;
}
.link:hover {
  color: var(--brand);
  transform: translateY(-1px);
}
.link:hover::after {
  background: var(--brand);
  transform: scaleX(1);
}
.link.is-active {
  color: var(--brand);
  font-weight: 700;
}
.link.is-active::after {
  background: var(--brand);
  transform: scaleX(1);
}
.link:focus-visible {
  box-shadow: 0 0 0 2px rgba(44, 76, 151, 0.15);
  background: rgba(44, 76, 151, 0.05);
}

/* ---------- Country + State + City Selector ---------- */
.country-selector {
  position: relative;
  margin-right: 12px;
  flex: 0 0 auto;
}

.country-trigger {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: transparent;
  border: 1px solid rgba(17, 35, 56, 0.12);
  border-radius: 999px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 14px;
  font-weight: 600;
  color: var(--ink);
}
.country-trigger:hover {
  background: rgba(44, 76, 151, 0.05);
  border-color: rgba(44, 76, 151, 0.3);
}
.country-trigger:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px rgba(44, 76, 151, 0.2);
}
.country-trigger.is-active {
  background: rgba(44, 76, 151, 0.08);
  border-color: rgba(44, 76, 151, 0.45);
  box-shadow: 0 0 0 1px rgba(44, 76, 151, 0.35);
}
.flag-placeholder {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 16px;
  border-radius: 3px;
  overflow: hidden;
  background: #e3e8f4;
}
.flag-img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.country-code {
  font-weight: 700;
}
.country-trigger .chev {
  width: 6px;
  height: 6px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: rotate(45deg);
  transition: transform 0.2s ease;
}
.country-trigger[aria-expanded="true"] .chev {
  transform: rotate(-135deg);
}

/* Mega dropdown container ‚Äì full-width centered */
.country-dropdown {
  position: absolute;
  top: calc(100% + 10px);
  left: 50%;
  right: auto;
  width: min(1120px, calc(100vw - 32px));
  background: var(--nav-bg);
  border: 1px solid var(--nav-border);
  border-radius: 18px;
  box-shadow: 0 24px 60px rgba(15, 27, 45, 0.35);
  opacity: 0;
  visibility: hidden;
  transform: translate3d(-50%, -12px, 0) scale(0.98);
  transition:
    opacity 0.25s ease,
    transform 0.25s ease,
    visibility 0.25s ease,
    box-shadow 0.25s ease;
  z-index: 1000;
  backdrop-filter: saturate(140%) blur(10px);
  -webkit-backdrop-filter: saturate(140%) blur(10px);
}
.country-dropdown.open {
  opacity: 1;
  visibility: visible;
  transform: translate3d(-50%, 0, 0) scale(1);
  box-shadow: 0 28px 70px rgba(15, 27, 45, 0.45);
}

.country-mega {
  display: flex;
  flex-direction: column;
  overflow: hidden;
  border-radius: inherit;
}

.country-mega-header {
  padding: 12px 20px;
  border-bottom: 1px solid rgba(17, 35, 56, 0.08);
  background: radial-gradient(circle at top left, #f8f3e7, #ffffff);
}
.country-mega-title {
  font-size: 13px;
  font-weight: 700;
  color: var(--ink-dim);
  text-transform: uppercase;
  letter-spacing: 0.09em;
}

.country-mega-body {
  display: flex;
  align-items: flex-start;
  animation: fadeSlideUp 0.25s ease-out;
}

/* Left column: countries */
.country-column {
  width: 260px;
  flex-shrink: 0;
  border-right: 1px solid rgba(17, 35, 56, 0.08);
  padding: 10px 0 12px 14px;
  min-height: 230px;
  background: linear-gradient(
    180deg,
    rgba(44, 76, 151, 0.02),
    rgba(44, 76, 151, 0.01)
  );
}

.country-search-container {
  padding: 0 10px 10px 4px;
}
.country-search {
  width: 100%;
  padding: 8px 10px;
  border: 1px solid rgba(17, 35, 56, 0.14);
  border-radius: 999px;
  font-size: 13px;
  transition: border-color 0.2s ease, box-shadow 0.2s ease,
    background 0.2s ease;
  background: rgba(255, 255, 255, 0.9);
}
.country-search:focus {
  outline: none;
  border-color: var(--brand);
  box-shadow: 0 0 0 2px rgba(44, 76, 151, 0.12);
  background: #ffffff;
}

.country-list {
  max-height: 320px;
  overflow-y: auto;
  padding: 4px 4px 8px 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* custom scrollbar */
.country-list::-webkit-scrollbar,
.state-column::-webkit-scrollbar,
.city-column::-webkit-scrollbar {
  width: 6px;
}
.country-list::-webkit-scrollbar-thumb,
.state-column::-webkit-scrollbar-thumb,
.city-column::-webkit-scrollbar-thumb {
  background: rgba(15, 27, 45, 0.25);
  border-radius: 999px;
}
.country-list::-webkit-scrollbar-track,
.state-column::-webkit-scrollbar-track,
.city-column::-webkit-scrollbar-track {
  background: transparent;
}

.country-item {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  padding: 7px 9px;
  background: transparent;
  border-radius: 10px;
  border: 1px solid transparent;
  cursor: pointer;
  font-size: 13px;
  text-align: left;
  color: var(--ink-dim);
  transition:
    background 0.18s ease,
    border-color 0.18s ease,
    transform 0.1s ease,
    box-shadow 0.18s ease;
}
.country-item:hover {
  background: rgba(44, 76, 151, 0.06);
  border-color: rgba(44, 76, 151, 0.3);
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(15, 27, 45, 0.15);
}
.country-item.selected {
  background: rgba(44, 76, 151, 0.12);
  border-color: var(--brand);
  color: var(--brand);
  font-weight: 600;
  box-shadow: 0 0 0 1px rgba(44, 76, 151, 0.4);
}

.country-flag {
  width: 22px;
  height: 16px;
  border-radius: 3px;
  overflow: hidden;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}
.country-name {
  flex: 1;
  text-transform: capitalize;
}

/* Middle column: states */
.state-column {
  flex: 1;
  padding: 10px 16px 12px 18px;
  max-height: 340px;
  overflow-y: auto;
  border-right: 1px solid rgba(17, 35, 56, 0.08);
}
.state-column-header {
  padding: 4px 0 8px;
  border-bottom: 1px solid rgba(17, 35, 56, 0.08);
  margin-bottom: 8px;
}
.state-column-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--ink);
}
.selected-country-name {
  font-weight: 700;
  color: var(--brand);
}

.state-list {
  display: flex;
  flex-wrap: wrap;
  gap: 4px 18px;
  padding-top: 4px;
}
.state-item {
  flex: 0 0 calc(50% - 12px);
  text-align: left;
  border: none;
  background: transparent;
  padding: 6px 2px;
  font-size: 13px;
  color: var(--ink-dim);
  cursor: pointer;
  border-radius: 6px;
  transition:
    background 0.15s ease,
    color 0.15s ease,
    padding-left 0.15s ease,
    box-shadow 0.15s ease;
}
.state-item:hover {
  background: rgba(44, 76, 151, 0.08);
  color: var(--brand);
  padding-left: 4px;
}
.state-item.selected {
  background: rgba(44, 76, 151, 0.16);
  color: var(--brand);
  font-weight: 600;
  box-shadow: 0 0 0 1px rgba(44, 76, 151, 0.4);
}
.state-empty {
  font-size: 13px;
  color: rgba(15, 34, 53, 0.6);
  padding-top: 6px;
}

/* Right column: cities */
.city-column {
  flex: 1;
  padding: 10px 16px 12px 18px;
  max-height: 340px;
  overflow-y: auto;
}
.city-column-header {
  padding: 4px 0 8px;
  border-bottom: 1px solid rgba(17, 35, 56, 0.08);
  margin-bottom: 8px;
}
.city-column-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--ink);
}
.selected-state-name {
  font-weight: 700;
  color: var(--brand);
}

.city-list {
  display: flex;
  flex-wrap: wrap;
  gap: 4px 18px;
  padding-top: 4px;
}
.city-item {
  flex: 0 0 calc(50% - 12px);
  text-align: left;
  border: none;
  background: transparent;
  padding: 6px 2px;
  font-size: 13px;
  color: var(--ink-dim);
  cursor: pointer;
  border-radius: 6px;
  transition:
    background 0.15s ease,
    color 0.15s ease,
    padding-left 0.15s ease,
    box-shadow 0.15s ease;
}
.city-item:hover {
  background: rgba(44, 76, 151, 0.08);
  color: var(--brand);
  padding-left: 4px;
}
.city-item.selected {
  background: rgba(44, 76, 151, 0.16);
  color: var(--brand);
  font-weight: 600;
  box-shadow: 0 0 0 1px rgba(44, 76, 151, 0.4);
}
.city-empty {
  font-size: 13px;
  color: rgba(15, 34, 53, 0.6);
  padding-top: 6px;
}

/* CTA */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  font-weight: 700;
  padding: 12px 20px;
  border-radius: 12px;
  text-decoration: none;
  line-height: 1;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  position: relative;
  overflow: hidden;
  font-size: 15px;
}
.btn::before {
  content: "";
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.3),
    transparent
  );
  transition: left 0.5s ease;
}
.btn:hover::before {
  left: 100%;
}
.btn.cta {
  background: linear-gradient(135deg, var(--gold), #eac271);
  color: var(--tp-common-black, #0f2235);
  box-shadow: 0 6px 16px rgba(214, 167, 75, 0.2),
    0 1px 0 rgba(255, 255, 255, 0.45) inset;
  margin-left: clamp(12px, 2vw, 28px);
  flex: 0 0 auto;
}
.btn.cta:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(214, 167, 75, 0.3),
    0 1px 0 rgba(255, 255, 255, 0.45) inset;
}
.btn .chev {
  width: 8px;
  height: 8px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: rotate(-45deg);
  margin-top: 1px;
  transition: transform 0.2s ease;
}
.btn:hover .chev {
  transform: rotate(-45deg) translateX(2px);
}

/* Hamburger */
.nav-toggle {
  display: none;
}
.hamburger {
  display: none;
  position: relative;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  cursor: pointer;
  padding: 0;
  border: none;
  background: transparent;
  transition: all 0.3s ease;
}
.hamburger-box {
  width: 22px;
  height: 16px;
  display: inline-block;
  position: relative;
}
.hamburger-inner {
  display: block;
  top: 50%;
  margin-top: -1px;
}
.hamburger-inner,
.hamburger-inner::before,
.hamburger-inner::after {
  width: 22px;
  height: 2px;
  background-color: var(--ink);
  border-radius: 2px;
  position: absolute;
  transition: transform 0.3s ease, background-color 0.3s ease,
    opacity 0.3s ease;
}
.hamburger-inner::before,
.hamburger-inner::after {
  content: "";
  display: block;
}
.hamburger-inner::before {
  top: -6px;
}
.hamburger-inner::after {
  bottom: -6px;
}
.hamburger:hover {
  background: rgba(44, 76, 151, 0.06);
}
.hamburger:hover .hamburger-inner,
.hamburger:hover .hamburger-inner::before,
.hamburger:hover .hamburger-inner::after {
  background-color: var(--brand);
}

/* morph to X */
#nav-open:checked + .container .nav-shell .hamburger .hamburger-inner {
  transform: rotate(45deg);
}
#nav-open:checked
  + .container
  .nav-shell
  .hamburger
  .hamburger-inner::before {
  top: 0;
  transform: rotate(-90deg);
}
#nav-open:checked
  + .container
  .nav-shell
  .hamburger
  .hamburger-inner::after {
  bottom: 0;
  opacity: 0;
}

/* Drawer & overlay */
.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.35);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
  z-index: 1000;
}
.mobile-drawer {
  position: fixed;
  inset: 0;
  padding-top: max(12px, env(safe-area-inset-top));
  background: transparent;
  pointer-events: none;
  display: grid;
  place-items: start;
  z-index: 1100;
}
.mobile-nav {
  width: min(500px, 92vw);
  margin: 12px auto;
  border-radius: 20px;
  background: rgba(255, 255, 255, 0.98);
  -webkit-backdrop-filter: saturate(140%) blur(12px);
  backdrop-filter: saturate(140%) blur(12px);
  border: 1px solid var(--nav-border);
  box-shadow: 0 20px 50px rgba(17, 35, 56, 0.15);
  transform: translateY(-12px);
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  padding: 20px var(--page-xpad, 16px) 24px;
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.mobile-nav-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-bottom: 6px;
  margin-bottom: 6px;
  border-bottom: 1px solid rgba(17, 35, 56, 0.08);
}
.mobile-nav-title {
  font-size: 16px;
  font-weight: 700;
  color: var(--ink);
}
.close-menu {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  cursor: pointer;
  border: none;
  background: rgba(44, 76, 151, 0.08);
  transition: background 0.2s ease, transform 0.2s ease;
}
.close-menu:hover,
.close-menu:focus-visible {
  background: rgba(44, 76, 151, 0.14);
  outline: none;
  transform: translateY(-1px);
}
.close-menu-icon {
  position: relative;
  width: 16px;
  height: 16px;
  display: block;
}
.close-menu-icon::before,
.close-menu-icon::after {
  content: "";
  position: absolute;
  inset: 0;
  margin: auto;
  width: 16px;
  height: 2px;
  border-radius: 2px;
  background: var(--ink);
  transition: background 0.3s ease;
}
.close-menu-icon::before {
  transform: rotate(45deg);
}
.close-menu-icon::after {
  transform: rotate(-45deg);
}
.m-link {
  display: block;
  padding: 14px 18px;
  border-radius: 10px;
  font-weight: 600;
  color: var(--ink);
  text-decoration: none;
  background: transparent;
  transition: all 0.25s ease;
  position: relative;
  overflow: hidden;
  font-size: 16px;
}
.m-link::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 3px;
  height: 100%;
  background: var(--brand);
  transform: scaleY(0);
  transform-origin: bottom;
  transition: transform 0.25s ease;
}
.m-link:hover {
  background: rgba(44, 76, 151, 0.08);
  color: var(--brand);
  padding-left: 22px;
}
.m-link:hover::before {
  transform: scaleY(1);
}
.m-link.is-active {
  background: rgba(44, 76, 151, 0.12);
  color: var(--brand);
  font-weight: 700;
  padding-left: 22px;
}
.m-link.is-active::before {
  transform: scaleY(1);
}
.btn.m-cta {
  margin-top: 12px;
  background: linear-gradient(135deg, var(--gold), #eac271);
  color: #0f2235;
  justify-content: center;
  box-shadow: 0 6px 16px rgba(214, 167, 75, 0.2);
  font-weight: 700;
}
.btn.m-cta:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 20px rgba(214, 167, 75, 0.3);
}

/* open states & body lock */
#nav-open:checked ~ .overlay {
  opacity: 1;
  pointer-events: auto;
}
#nav-open:checked ~ .mobile-drawer {
  pointer-events: auto;
}
#nav-open:checked ~ .mobile-drawer .mobile-nav {
  transform: translateY(0);
  opacity: 1;
}
body:has(#nav-open:checked) {
  overflow: hidden;
}

/* ---------- animations ---------- */
@keyframes fadeSlideUp {
  from {
    opacity: 0;
    transform: translateY(6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ---------- breakpoints ---------- */
@media (max-width: 1100px) {
  .nav-links {
    display: none;
  }
  .btn.cta {
    display: none;
  }
  .hamburger {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: auto;
  }
  .logo {
    height: 42px;
    max-height: 42px;
  }
  .nav-shell {
    justify-content: space-between;
    gap: 12px;
  }
}

@media (max-width: 900px) {
  .country-mega-body {
    flex-direction: column;
  }
  .country-column {
    width: 100%;
    border-right: none;
    border-bottom: 1px solid rgba(17, 35, 56, 0.08);
    padding-right: 14px;
  }
  .state-column,
  .city-column {
    border-right: none;
    max-height: 260px;
  }
  .state-item,
  .city-item {
    flex: 0 0 50%;
  }
}

@media (max-width: 768px) {
  .nav-shell {
    gap: 10px;
    padding: 10px 12px;
  }
  .logo {
    height: 38px;
    max-height: 38px;
  }
  .hamburger {
    width: 42px;
    height: 42px;
  }
  .mobile-nav {
    border-radius: 18px;
    padding: 18px var(--page-xpad, 16px) 22px;
  }

  .country-dropdown {
    width: calc(100vw - 24px);
    transform: translate3d(-50%, -10px, 0) scale(0.98);
  }
  .country-dropdown.open {
    transform: translate3d(-50%, 0, 0) scale(1);
   
  }
}

@media (max-width: 480px) {
  .logo {
    height: 34px;
    max-height: 34px;
  }
  .hamburger {
    width: 40px;
    height: 40px;
  }
  .hamburger-box {
    width: 20px;
    height: 14px;
  }
  .hamburger-inner,
  .hamburger-inner::before,
  .hamburger-inner::after {
    width: 20px;
  }
  .mobile-nav {
    border-radius: 16px;
    padding: 16px var(--page-xpad, 16px) 20px;
  }
  .m-link {
    padding: 12px 16px;
    font-size: 15px;
  }
  .state-item,
  .city-item {
    flex: 0 0 100%;
  }
}

@media (max-width: 420px) {
  .nav-shell {
    border-radius: 20px;
  }
  .logo {
    height: 30px;
    max-height: 30px;
  }
  .hamburger {
    width: 38px;
    height: 38px;
  }
  .mobile-nav {
    border-radius: 14px;
    padding: 14px var(--page-xpad, 16px) 18px;
  }
}

/* ---------- dark theme ---------- */
.theme-dark .site-header {
  --nav-bg: rgba(15, 27, 45, 0.88);
  --nav-border: rgba(255, 255, 255, 0.12);
  --nav-shadow: 0 16px 40px rgba(0, 0, 0, 0.4);
  --ink: var(--tp-common-black, #e7edf6);
  --ink-dim: rgba(231, 237, 246, 0.75);
}
.theme-dark .btn.cta {
  color: #0f1b2d;
}
.theme-dark .hamburger .hamburger-inner,
.theme-dark .hamburger .hamburger-inner::before,
.theme-dark .hamburger .hamburger-inner::after {
  background-color: var(--tp-common-black);
}
.theme-dark .hamburger:hover .hamburger-inner,
.theme-dark .hamburger:hover .hamburger-inner::before,
.theme-dark .hamburger:hover .hamburger-inner::after {
  background-color: var(--tp-theme-secondary);
}
.theme-dark .mobile-nav {
  background: rgba(15, 27, 45, 0.95);
  border-color: rgba(255, 255, 255, 0.15);
}
.theme-dark .mobile-nav-header {
  border-color: rgba(255, 255, 255, 0.12);
}
.theme-dark .mobile-nav-title {
  color: var(--tp-common-black, #e7edf6);
}
.theme-dark .close-menu {
  background: rgba(44, 76, 151, 0.16);
}
.theme-dark .close-menu:hover,
.theme-dark .close-menu:focus-visible {
  background: rgba(44, 76, 151, 0.22);
}
.theme-dark .close-menu-icon::before,
.theme-dark .close-menu-icon::after {
  background: var(--tp-common-black, #e7edf6);
}
.theme-dark .m-link:hover {
  background: rgba(44, 76, 151, 0.2);
}
.theme-dark .link:focus-visible {
  box-shadow: 0 0 0 2px rgba(44, 76, 151, 0.3);
  background: rgba(44, 76, 151, 0.1);
}
</style>
